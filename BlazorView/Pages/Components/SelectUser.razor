@using BlazorView.Data
@inject NavigationManager navigationManager
@inject ILogger<SelectUser> logger


<h5>Velg aktiv bruker:</h5>
@if (users != null)
{
<EditForm Model="@userModel">
    <select @bind="selectedUser">

        <option value="">Velg bruker</option>
        @foreach (var item in users)
        {
            <option value="@item.Name">@item.Name</option>
        }
    </select>
    <button @onclick="selectUser">Velg bruker</button>

</EditForm>
}
else
{
        <p>Det er desverre utfordringer med å nå bruker databasen akkurat nå. Prøv igjen senere.</p>
}




@code {
    private class UserModel
    {
        public UserModel()
        {

        }
    }

    UserModel userModel = new();
    String selectedUser;
    User user = new();

    [Parameter]
    public IEnumerable<User>? users { get; set; }



    private void selectUser()
    {
        if (selectedUser != null)
        {
            findSelectedUser();

            logger.LogInformation("Selecting new user as logged in user, name: {0}, time: {time}", user.Name, DateTimeOffset.Now);

            LoggedInUserService.Name = user.Name;
            LoggedInUserService.Id = user.Id;

            navigationManager.NavigateTo("/");
        }

    }

    private void findSelectedUser()
    {
        foreach (var item in users)
        {
            if (item.Name.Equals(selectedUser))
            {
                user.Name = item.Name;
                user.Id = item.Id;
            }
        }
    }
}

